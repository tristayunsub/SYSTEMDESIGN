컨슈머의 내부동작과 컨슈머 어플리케이션에서 메세지 소비하는 과정



내부동작을 알아야 디버깅할때 도움이 많이되며, 올바른 결정하게 해줌

컨슈머의 역할: consumer's role

```
subscribe topic: 컨슈머의 동작의 시작은 토픽의 구독

offset point: * 카프카는 다른큐와다르게 메시지 오프셋을 저장 안함, 
              * 오프셋은 각자의 컨슈머들이 유지해야함.(컨슈머 api사용)

재연/되감기/메시지 스킵: 상황에따라, 커스텀하게 오프셋 변경. 재연/되감기/ 메세지 스킵 가능

하트비트? : 컨슈머의 지정된 파티션의 멤버쉽과 소유권을 확인하기 위해. 하트비트를 이용하여

오프셋 커밋: 리밸런싱이 일어날때 이미 읽은 오프셋을 다시 읽을 수 있으므로, 오프셋 커밋을함

역직렬화?: 프로듀서에서는 카프카에 메시지를 보낼때, 어떤 직렬화 했는지 명시하고 컨슈머에서는 역직렬화를 명시함.

```


메세지 subscribe를 위한 mechanism

1.토픽 구독 ->2. 카프카 서버 조사(풀루프): 서버조정, 파티션 리밸런스, 컨슈머 하트비트 체크등.

->3. 새로운 레코드가 있는지 체크하고 있으면 가져옴

->4. 역직렬화

->5. 데이터 유효성 검증?

->6. 다른 시스템에 이관 및 저장.


컨슈머 어플리케이션

프로듀서 API와 마찬가지로 컨슈머도 풍부한 API세트를 제공.

```
bootstrap.servers : 브로커 주소목록, hostname:port 형식

key.deserializer.

value.deserializer: 메세지값 정보에 대한 역직렬화

group.id 컨슈머 그룹 정의


```


컨슈머 모범 사례


예외처리 확실히

리밸런스 관리: 새로운 컨슈머가 컨슈머 그룹에 합류할떔다. 혹은 예전 컨슈머가 종료된다면. 파티션 리밸런스가 트리거된다.

컨슈머가 파티션 소유권을 잃을때마다. 가장 최근에 수신한 오프셋을 반드시 커밋해줌

제때 오프셋 커밋: 메시지 오프셋에 대한 커밋은 처리 상황에 따라 잘 제때 수행.


오프셋 주기에 따른 성능과 종목에 대한 문제간의 트레이드 오프가 생김.


자동오프셋 커밋: 중복 처리에 대한 문제가 없거나, 컨슈머가 자동으로 오프세을 커밋하도록 관리하기를 바랄 경우 사용한다.






