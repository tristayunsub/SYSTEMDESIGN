https://uiandwe.tistory.com/1325


컨시스턴트 해싱.. 여러 스토리지 서버간에 데이터를 분할하여`? 스토리지 시스템의 확장성을 구현하기 위해 수행된다.

많은 서버. 데이터베이스 서버+ 파티션 에 많은 데이터가 분산ㄴ되어있고. 사용 가능한 서버 수가 지속적으로 변경되는 경우.


단순 해싱을 쓸 수 없는 이유.

간단한 해싱은 데이터와 지정된 키를 모듈러 함수를 통해 지정된 범위의 숫자로 생성.

모듈러 함수로 md5 사용한다면 

0~2^128−1 범위에서 임의의 값을 얻을 수 있다.



server_number = hash(key)%n 로 계산된다. 이것은 [0- (n-1)] 범위로 제공하며 n은 서버의 수가 된다.

이렇게 하면 서버수에 따라 데이터가 완벽하게 나뉜다.

value를 3대의 서버로 나누기 위해 n=3으로 설정하고 계산하면 다음과 같다.



이때 새로운 서버가 추가되면 문제가 발생한다.


새 서버에도 키를 추가해야 하며 이를 위해 각 키의 서버 번호를 찾기 위해 모든 해시를 다시 계산해야 하므로 (서버 대수 = 4) 데이터의 위치가 변경된다.

n=4로 설정 후 다시 계산하면 다음과 같다.




또 한가지 문제는 서버가 제거될 때 발생한다. 이때에도 해시(갱신된 서버 개수)를 다시 계산해야 한다.

우리가 직면하게 될 문제는 데이터의 쏠림이다. 한 서버엔 너무 많은 키가 할당되어 있고, 다른 서버의 데이터는 너무 적거나 키가 균일하지 않게 배포됩니다.



* 서버 추가 시 다시 계산 후 할당
* 서버 제거 시 다시 계산 후 할당
* 키의 비균일 분포


일관된 해싱은 재구성이 최소화되는 방식으로 노드/서버 집합에 데이터를 배포 방식이다.

일관된 해싱은 노드  or 서버 수에 독립적으로 작동한다.

https://blog.voidmainvoid.net/467?category=912403
