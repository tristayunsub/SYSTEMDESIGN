샤딩 -> 조각내다 데이터베이스의 데이터를 분할한다.

데이터의 분산저장. 한대의 서버에 빅데이터 넣기 힘듬

데이터를 분산하여 순차 저장. 트래픽으로 인한 부하를 효과적으로 처리

백업과 복구전략. 서버의 데이터 유실에 대비해 미리 데이터를 분산하여 저장

빠른 성능: 여러대의 독립 프로세스가 병렬로 작업 수행. 빠른처리 선으

샤딩 시스템의 구조

- mongos: 라우터, 3개의 shar에 분산하여 데이터 저장.





샤딩 시스템 특징

* 샤드 서버로 운영하게 되면 한대로 운영할때보다 메모리를 20~30% 더 사용하게된다
   *  샤드 시스템 구축시 사용하는 라우팅 서버인 mongos와 OpLog, Balancer 프로세스가 메모리를 추가로 사용
   *  20~30% 추가 메모리 소요



 **config 서버**
 
* 샤드 시스템에 대한 메타데이터를 저장/관리하는 역할
* 샤드 서버의 인덱스를 빠르게 검색할 수 있게 함
* 샤드 서버와 별도의 서버에 구축해야 장애발생에 대응하기 원활
* 1대만으로 운영이 가능하나 장애발생에 대비하여 3대 이상 사용 권장
* 샤드 서버에 비해 저사양 서버 사용 가능
 
 
 
 mongos 서버
 
* 하나 이상의 프로세스 사용
* config 서버의 metadata 를 캐시함
* 빅데이터를 샤드 서버로 분산시켜주는 프로세스
* config 서버는 각 샤드 서버에 어떤 데이터들이어떤식으로 분산되어있는 지에 관한 내용 가지고있느데, mongoㄴ 서버를 통해 그걸 읽고 쓰기가능


Shard Key 구성

* shard key 구성은 mongodb 샤딩 시스템을 구축할때 매우 중요
* shard key는 여러개의 shard서버로 분할될 기준 필드를 가리키며, partition과 load balancing의 기준이된다. 데이터 저장과 성능에 절대적 영햐을 미침
* shard key는 카디널리티 를 보고 적절한 선택이필요

**데이터 분포가 넓으면 low 카디널리티, 높으면 high**

예를들어 사원번호는 고유값이므로 높은 카디널리티

성별은 남녀 두개의 값만 가지므로 샤드키로 사용하면 인덱스 도움 받을수없다

```
Shard key는 Chunk migration의 횟수와 빈도를 결정함
Chunk migration: 서버에 균등하게 데이터를 이동하여 재조정하는 과정
Chunk: 하나의 서버에 저장되는 데이터를 여러 개의 논리적 구조로 분할저장하다가 일정한 데이터 양에 도달했을 때 두 번째, 세 번째 서버로 데이터를 분할하여 저장하는데 이 분할 단위를 Chunk라고 함
Chunk의 크기는 기본적으로 64MB(100,000행) 단위로 분할되며, 필요시 64MB 이상의 크기로 설정할 수 있음
기본 설정 단위보다 빈번하게 Chunk migration이 발생한다면 Chunk의 크기를 더욱 크게 설정해야함

 ```
 
 
 
 
 
 
